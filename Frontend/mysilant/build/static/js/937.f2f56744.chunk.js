"use strict";(self.webpackChunkmysilant=self.webpackChunkmysilant||[]).push([[937],{937:function(t,e,n){n.r(e),n.d(e,{default:function(){return d}});var r=n(885),i={machine_to:"AllTO_machine_to__tPRxn",table_container:"AllTO_table_container__CtRPc",table_to:"AllTO_table_to__SC7UV",error_message:"AllTO_error_message__9X5yP",add_btn:"AllTO_add_btn__rEoAL"},a=n(791),c={machine_filters:"TOFilter_machine_filters__0J9SL",filters:"TOFilter_filters__i9nOP",delete_button:"TOFilter_delete_button__lazS-",buttons:"TOFilter_buttons__5UflM"},o=n(184);function s(t){var e=t.setFilters,n=(0,a.useState)(""),i=(0,r.Z)(n,2),s=i[0],u=i[1],l=(0,a.useState)(""),d=(0,r.Z)(l,2),h=d[0],f=d[1],p=(0,a.useState)(""),_=(0,r.Z)(p,2),m=_[0],j=_[1];return(0,o.jsxs)("div",{className:c.machine_filters,children:[(0,o.jsx)("p",{children:"\u0424\u0438\u043b\u044c\u0442\u0440:"}),(0,o.jsxs)("form",{className:c.filters,onSubmit:function(t){t.preventDefault();var n=[];s&&n.push("service_type=".concat(s)),h&&n.push("machine=".concat(h)),m&&n.push("service_center=".concat(m)),console.log("?".concat(n.join("&"))),e("?".concat(n.join("&")))},children:[(0,o.jsx)("input",{type:"text",name:"service_type",placeholder:"\u0412\u0438\u0434 \u0422\u041e",value:s,onChange:function(t){return e=t.target.value,void u(e.toUpperCase());var e}}),(0,o.jsx)("input",{type:"text",name:"machine",placeholder:"\u0417\u0430\u0432. \u043d\u043e\u043c\u0435\u0440 \u043c\u0430\u0448\u0438\u043d\u044b",value:h,onChange:function(t){return f(t.target.value)}}),(0,o.jsx)("input",{type:"text",name:"service_center",placeholder:"\u0421\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f",value:m,onChange:function(t){return j(t.target.value)}}),(0,o.jsxs)("div",{className:c.buttons,children:[(0,o.jsx)("button",{type:"submit",title:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u0438\u043b\u044c\u0442\u0440\u044b",children:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c"}),(0,o.jsx)("button",{className:c.delete_button,onClick:function(t){t.preventDefault(),u(""),f(""),j(""),e("")},title:"\u0421\u0431\u0440\u043e\u0441 \u0444\u0438\u043b\u044c\u0442\u0440\u0430",children:"x"})]})]})]})}var u=n(88),l=n(112);function d(t){var e=t.directory,n=t.users,c=t.userGroup,d=t.machines,h=(0,a.useState)({}),f=(0,r.Z)(h,2),p=f[0],_=f[1],m=(0,a.useState)(""),j=(0,r.Z)(m,2),x=j[0],b=j[1],v=(0,a.useState)(!1),y=(0,r.Z)(v,2),g=y[0],O=y[1],S=(0,a.useState)(""),T=(0,r.Z)(S,2),C=T[0],k=T[1],Z=(0,a.useState)("to_list"),D=(0,r.Z)(Z,2),P=D[0],N=D[1],w=(0,a.useState)({}),E=(0,r.Z)(w,2),F=E[0],L=E[1],R=(0,a.useState)(0),A=(0,r.Z)(R,2),U=A[0],I=A[1];(0,a.useEffect)((function(){O(!0),fetch("http://localhost:8000/api/to/".concat(C),{headers:{"Content-Type":"application/json;charset=utf-8"},credentials:"include"}).then((function(t){if(t.ok)return t.json();throw Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){_(t),b(""),O(!1)})).catch((function(t){b("\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. ".concat(t)),console.log(t),O(!1)}))}),[C,U]);var X=function(t,e){t.preventDefault(),L(e),N("to_detail")},G=(0,a.useState)({}),J=(0,r.Z)(G,1)[0],M=function(t){J.hasOwnProperty(t)?(J[t]=!J[t],(0,l.R)(t,p,_,e,!0===J[t]?"increase":"decrease")):(J[t]=!0,(0,l.R)(t,p,_,e,!0===J[t]?"increase":"decrease"))};return(0,o.jsxs)("div",{className:i.machine_to,children:["to_create"===P?(0,o.jsx)(u.Z,{directory:e,toProp:{date:(new Date).toISOString().split("T")[0],duration:0,id:0,machine:0,machine_number:"",order:"",order_date:(new Date).toISOString().split("T")[0],service_center:0,service_type:0},userGroup:c,users:n,machines:d,setToPage:N,toPage:P,updateList:U,setUpdateList:I}):null,"to_detail"===P?(0,o.jsx)(u.Z,{directory:e,toProp:F,userGroup:c,users:n,machines:d,setToPage:N,toPage:P,setUpdateList:I,updateList:U}):null,"to_list"===P?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{type:"button",className:i.add_btn,onClick:function(t){t.preventDefault(),N("to_create")},children:"+ \u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0422\u041e"}),(0,o.jsx)(s,{setFilters:k}),(0,o.jsx)("div",{className:i.table_container,children:(0,o.jsxs)("table",{className:i.table_to,children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{onClick:function(){return M("order_date")},children:"\u0414\u0430\u0442\u0430 \u0437\u0430\u043a\u0430\u0437-\u043d\u0430\u0440\u044f\u0434\u0430"}),(0,o.jsx)("th",{onClick:function(){return M("order")},children:"\u2116 \u0437\u0430\u043a\u0430\u0437-\u043d\u0430\u0440\u044f\u0434\u0430"}),(0,o.jsx)("th",{onClick:function(){return M("machine_number")},children:"\u0417\u0430\u0432. \u2116 \u043c\u0430\u0448\u0438\u043d\u044b"}),(0,o.jsx)("th",{onClick:function(){return M("service_type")},children:"\u0412\u0438\u0434 \u0422\u041e"}),(0,o.jsx)("th",{onClick:function(){return M("date")},children:"\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0422\u041e"}),(0,o.jsx)("th",{onClick:function(){return M("duration")},children:"\u041d\u0430\u0440\u0430\u0431\u043e\u0442\u043a\u0430, \u043c/\u0447\u0430\u0441"}),(0,o.jsx)("th",{children:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f, \u043f\u0440\u043e\u0432\u043e\u0434\u0438\u0432\u0448\u0430\u044f \u0422\u041e"})]})}),g?(0,o.jsx)("tbody",{children:(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:7,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."})})}):(0,o.jsxs)("tbody",{children:[p.length>0&&Object.entries(n).length>0&&Object.entries(e).length>0?p.map((function(t){return(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:new Date(t.order_date).toLocaleDateString()}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:t.order}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:t.machine_number}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:e.find((function(e){return e.id===t.service_type})).title}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:new Date(t.date).toLocaleDateString()}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:t.duration}),(0,o.jsx)("td",{onClick:function(e){return X(e,t)},children:n.find((function(e){return e.id===t.service_center})).first_name})]},t.id)})):(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:7,children:"\u0422\u041e \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"})}),x?(0,o.jsx)("tr",{children:(0,o.jsx)("td",{colSpan:7,className:i.error_message,children:x})}):null]})]})})]}):null]})}},88:function(t,e,n){n.d(e,{Z:function(){return l}});var r=n(683),i=n(885),a={to_detail:"TODetail_to_detail__ITrZM",close_button:"TODetail_close_button__hN-Fb",textarea:"TODetail_textarea__HrWNe",submit:"TODetail_submit__fliv+",status_ok:"TODetail_status_ok__APoba",status_error:"TODetail_status_error__oFOn2"},c=n(791),o={description:"DirDescription_description__u11VK"},s=n(184);function u(t){var e=t.dirID,n=t.directory,r=(0,c.useState)({}),a=(0,i.Z)(r,2),u=a[0],l=a[1];return(0,c.useEffect)((function(){n&&e&&l(n.find((function(t){return t.id===+e})))}),[e,n]),(0,s.jsx)(s.Fragment,{children:u.description&&(0,s.jsx)("span",{className:o.description,children:u.description})})}function l(t){var e=t.directory,n=t.users,o=t.toProp,l=t.machines,d=t.setToPage,h=t.toPage,f=t.setUpdateList,p=t.updateList,_=(0,c.useState)({}),m=(0,i.Z)(_,2),j=m[0],x=m[1],b=(0,c.useState)(),v=(0,i.Z)(b,2),y=v[0],g=v[1],O=(0,c.useState)(""),S=(0,i.Z)(O,2),T=S[0],C=S[1],k=(0,c.useState)(0),Z=(0,i.Z)(k,2),D=Z[0],P=Z[1],N=(0,c.useState)(""),w=(0,i.Z)(N,2),E=w[0],F=w[1],L=(0,c.useState)(""),R=(0,i.Z)(L,2),A=R[0],U=R[1],I=(0,c.useState)(),X=(0,i.Z)(I,2),G=X[0],J=X[1],M=(0,c.useState)(),V=(0,i.Z)(M,2),z=V[0],H=V[1],K=(0,c.useState)(0),W=(0,i.Z)(K,2),q=W[0],B=W[1],Q=(0,c.useState)({}),Y=(0,i.Z)(Q,2),$=Y[0],tt=Y[1],et=(0,c.useState)(!1),nt=(0,i.Z)(et,2),rt=nt[0],it=nt[1],at=function(t){var e="; ".concat(document.cookie).split("; ".concat(t,"="));if(2===e.length)return e.pop().split(";").shift()}("csrftoken");(0,c.useEffect)((function(){o.hasOwnProperty("id")&&x((0,r.Z)({},o))}),[o]),(0,c.useEffect)((function(){j.hasOwnProperty("id")&&(g(j.id),C(j.date),P(j.duration),F(j.order),U(j.order_date),J(j.machine),H(j.service_type),B(j.service_center))}),[j]);return(0,s.jsxs)("div",{className:a.to_detail,children:["to_create"===h?(0,s.jsx)("h3",{children:"\u0414\u041e\u0411\u0410\u0412\u041b\u0415\u041d\u0418\u0415 \u041d\u041e\u0412\u041e\u0413\u041e \u0422\u041e."}):null,(0,s.jsx)("button",{type:"button",className:a.close_button,title:"\u0417\u0430\u043a\u0440\u044b\u0442\u044c",onClick:function(t){t.preventDefault(),d("to_list")},children:"X"}),(0,s.jsxs)("form",{autoComplete:"off",onSubmit:function(t){"to_detail"===h?function(t){t.preventDefault(),it(!0),fetch("http://localhost:8000/api/to/".concat(y),{method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":at},body:JSON.stringify({date:T,duration:D,order:E,order_date:A,service_type:z,service_center:q,machine:G}),credentials:"include"}).then((function(t){if(t.ok)return t.json();throw Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){x(t),tt({className:a.status_ok,statusText:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b"}),f(p+1)})).catch((function(t){tt({className:a.status_error,statusText:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043d\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b, \u043e\u0448\u0438\u0431\u043a\u0430 \n ".concat(t)}),console.log(t)})).finally((function(){it(!1)}))}(t):"to_create"===h&&function(t){t.preventDefault(),it(!0),fetch("http://localhost:8000/api/to/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":at},body:JSON.stringify({date:T,duration:D,order:E,order_date:A,service_type:z,service_center:q,machine:G}),credentials:"include"}).then((function(t){if(t.ok)return t.json();throw Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){x(t),tt({className:a.status_ok,statusText:"\u0417\u0430\u043f\u0438\u0441\u044c \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430"}),f(p+1)})).catch((function(t){tt({className:a.status_error,statusText:"\u0417\u0430\u043f\u0438\u0441\u044c \u043d\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430, \u043e\u0448\u0438\u0431\u043a\u0430 \n ".concat(t)}),console.log(t)})).finally((function(){it(!1)}))}(t)},children:[(0,s.jsxs)("label",{children:["\u0414\u0430\u0442\u0430 \u0437\u0430\u043a\u0430\u0437-\u043d\u0430\u0440\u044f\u0434\u0430:",(0,s.jsx)("input",{type:"date",name:"order_date",id:"",value:A,onChange:function(t){return U(t.target.value)}})]}),(0,s.jsxs)("label",{children:["\u2116 \u0437\u0430\u043a\u0430\u0437-\u043d\u0430\u0440\u044f\u0434\u0430:",(0,s.jsx)("input",{type:"text",name:"order",id:"",value:E,onChange:function(t){return F(t.target.value)}})]}),(0,s.jsxs)("label",{children:["\u041c\u0430\u0448\u0438\u043d\u0430:",(0,s.jsxs)("select",{value:G,onChange:function(t){return J(t.target.value)},name:"",id:"",children:[(0,s.jsx)("option",{value:0,disabled:!0,children:"== \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 =="}),l.map((function(t){return(0,s.jsxs)("option",{value:t.id,children:[t.machine_number," \xa0",e.find((function(e){return e.id===t.machine_model})).title]},t.id)}))]})]}),(0,s.jsxs)("label",{children:["\u0412\u0438\u0434 \u0422\u041e:",(0,s.jsxs)("select",{value:z,onChange:function(t){return H(t.target.value)},name:"",id:"",children:[(0,s.jsx)("option",{value:0,disabled:!0,children:"== \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 =="}),e.map((function(t){return"STP"===t.name?(0,s.jsx)("option",{value:t.id,children:t.title},t.id):null}))]})]}),(0,s.jsx)(u,{dirID:z,directory:e}),(0,s.jsxs)("label",{children:["\u0414\u0430\u0442\u0430 \u043f\u0440\u043e\u0432\u0435\u0434\u0435\u043d\u0438\u044f \u0422\u041e:",(0,s.jsx)("input",{type:"date",name:"date",id:"",value:T,onChange:function(t){return C(t.target.value)}})]}),(0,s.jsxs)("label",{children:["\u041d\u0430\u0440\u0430\u0431\u043e\u0442\u043a\u0430, \u043c/\u0447\u0430\u0441:",(0,s.jsx)("input",{type:"text",name:"duration",id:"",value:D,onChange:function(t){return P(t.target.value)}})]}),(0,s.jsxs)("label",{children:["\u0421\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f:",Object.entries(n).length>0?(0,s.jsxs)("select",{value:q,onChange:function(t){return B(t.target.value)},name:"",id:"",children:[(0,s.jsx)("option",{value:0,disabled:!0,children:"== \u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 =="}),n.map((function(t){return t.groups.includes(2)?(0,s.jsxs)("option",{value:t.id,children:[t.first_name," ",t.last_name]},t.id):null}))]}):null]}),(0,s.jsxs)("div",{className:a.submit,children:["to_detail"===h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{type:"submit",name:"submit",children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),(0,s.jsx)("button",{type:"button",name:"delete",onClick:function(t){return function(t,e){t.preventDefault(),window.confirm("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0437\u0430\u043a\u0430\u0437-\u043d\u0430\u0440\u044f\u0434 ".concat(e.order,"?"))&&fetch("http://localhost:8000/api/to/".concat(e.id),{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":at},credentials:"include"}).then((function(t){if(t.ok)return t;throw Error("".concat(t.status," ").concat(t.statusText))})).then((function(t){f(p+1),d("to_list")})).catch((function(t){tt({className:a.status_error,statusText:"\u041f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430 \n ".concat(t)}),console.log(t)}))}(t,j)},children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]}):null,"to_create"===h?(0,s.jsx)("button",{type:"submit",name:"submit",children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"}):null,rt?(0,s.jsx)("div",{className:a.status_ok,children:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."}):null,$?(0,s.jsx)("div",{className:$.className,children:$.statusText}):null]})]})]})}},112:function(t,e,n){n.d(e,{R:function(){return r}});var r=function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"increase",a=e.concat().sort((function(e,n){return"increase"===i?"number"===typeof e[t]&&"downtime"!==t&&"duration"!==t&&"id"!==t?r.find((function(n){return n.id===e[t]})).title>r.find((function(e){return e.id===n[t]})).title?1:-1:e[t]>n[t]?1:-1:"number"===typeof e[t]&&"downtime"!==t&&"duration"!==t&&"id"!==t?r.find((function(n){return n.id===e[t]})).title>r.find((function(e){return e.id===n[t]})).title?-1:1:e[t]>n[t]?-1:1}));n(a)}},683:function(t,e,n){n.d(e,{Z:function(){return c}});var r=n(142);function i(t,e,n){return(e=(0,r.Z)(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}}}]);
//# sourceMappingURL=937.f2f56744.chunk.js.map